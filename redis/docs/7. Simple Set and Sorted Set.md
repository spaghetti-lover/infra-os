# Simple Set and Sorted Set

## Simple Set

### What

Simple Set is an **unordered** collection of unique string

- [SADD](https://redis.io/docs/latest/commands/sadd/) adds a new member to a set
- [SREM](https://redis.io/docs/latest/commands/srem/) removes the specified member from the set
- [SISMEMBER](https://redis.io/docs/latest/commands/sismember/) tests a string for set membership
- [SMEMBERS](https://redis.io/docs/latest/commands/smembers/) return all the member of the set value stored at key

### Why

Pros:

- Cost only `O(1)` for CRUD

Cons:

- Range queries (`ZRANGEBYSCORE`) require full sorting → `O(N log N)`
- Rank queries (`ZRANK`) are inefficient without order.
- No ordering by score.

### How

- Use native hash to store value

  ```go
  type SimpleSet struct {
    key string
    dict map[string] struct {}
  }
  ```

- Add member to the set

  ```go
  // Add members to the set
  func (s *SimpleSet) Add(members ...string) int {
  	added := 0
  	for _, m := range members {
  		if _, exist := s.dict[m]; !exist {
  			s.dict[m] = struct{}{}
  			added++
  		}
  	}
  	return added
  }
  ```

- Remove member from the set

  ```go
  // Remove members from the set
  func (s *SimpleSet) Rem(members ...string) int {
  	removed := 0
  	for _, m := range members {
  		if _, exist := s.dict[m]; exist {
  			delete(s.dict, m)
  			removed++
  		}
  	}
  	return removed
  }
  ```

- Check member in the set

  ```go
  func (s *SimpleSet) IsMember(member string) int {
  	_, exist := s.dict[member]
  	if exist {
  		return 1
  	}
  	return 0
  }
  ```

- Take all element from the set
  ```go
  func (s *SimpleSet) Members() []string {
  	m := make([]string, 0, len(s.dict))
  	for k, _ := range s.dict {
  		m = append(m, k)
  	}
  	return m
  }
  ```

## Sorted Set

### What

A collected of unique string (members) orderd by an associated **score**. Usually combine with hash map to achieve O(1) for searching.

- [ZADD](https://redis.io/docs/latest/commands/zadd/): Adds all the specified members with the specified scores to the sorted set stored at key.
- [ZSCORE](https://redis.io/docs/latest/commands/zscore/): Returns the score of a member in the sorted set at key.
- [ZRANK](https://redis.io/docs/latest/commands/zrank/): Returns the rank of a member in the sorted set stored at key, with the scores ordered from low to high. The rank (or index) is 0-based, which means that the member with the lowest score has rank 0.

### Why

- Store elements and support comparisons
- Supppor flexible query:
  - "Take top 10 user with highest score" -> `ZREVRANGE key 0 9`
  - "Take articles from day A to day B" -> `ZRANGEBYSCORE key A B`
  - "Take rank of user X" -> `ZRANK key X`
- If only use `SET`, you need to:
  - Store extra data (map from member to score).
  - Perform manual sort for each query (CPU overhead, not real-time).
  - Miss optimized rank and range query support.

### How

- Approach 1: [Skip List](5.%20Skip%20List.md) - Probabilistic data structure with O(log n) expected performance but may cause memory overhead.

- Approach 2: [B+ Tree](5.%20B+Tree.md) - Provides O(log n) operations with good cache locality

## Questions?

- Understand each slide of B+ Tree?
- Nhờ giải thích code implement của B+ Tree?
- Có trường hợp split Leaf mà vẫn vi phạm điều kiện không?
- Giải thích chỗ tìm rank
